var app=angular.module("app",[]);app.run([function(){}]),$(document).ready(function(){$(".chat-container").css({height:$(window).height()})});var UI=function(e){function n(n){e("#chat-title").text(n)}return{setTitle:n}}(jQuery);angular.module("app").factory("session",["$q",function(){function e(e){t=e.username||"",o=e.id||"",localStorage.username=t,localStorage.userId=o}function n(){return{username:t,userId:o}}var t=localStorage.username||"",o=localStorage.userId||"";return{setUser:e,getUser:n}}]),angular.module("app").factory("chatApi",["socket","$q",function(e){function n(n){e.on("updatechat",n)}function t(n){e.on("updateusers",n)}function o(n){e.emit("switchRoom",n)}function a(n){e.emit("sendchat",n)}function r(n){e.emit("adduser",n)}return{onUpdateChat:n,onUpdateUsers:t,switchRoom:o,sendChatMessage:a,addUser:r}}]),angular.module("app").factory("socket",function(e,n){var t=n.io.connect(),o={on:function(n,o){t.on(n,function(){var n=arguments;e.$apply(function(){o.apply(t,n)})})},emit:function(n,o,a){t.emit(n,o,function(){var n=arguments;e.$apply(function(){a&&a.apply(t,n)})})}};return o.on("error",function(e,n){console.log("ERRROR "+n)}),o}),angular.module("app").controller("chatCtrl",["$scope","chatApi","session",function(e,n,t){e.state={welcomeShwn:!1},e.messages=[],e.chatTxtBox="",e.username="",e.users=[],e.sendChatMsg=function(){e.chatTxtBox.length&&(n.sendChatMessage(e.chatTxtBox),e.chatTxtBox="")},n.onUpdateChat(function(n){console.log("updatechat "+n),"string"!=typeof n&&e.messages.push({username:n.username,data:n.data,isMe:t.getUser().username===n.username})}),n.onUpdateUsers(function(e,n){console.log("updateusers "+n)})}]),angular.module("app").controller("welcomeCtrl",["$scope","$rootScope","chatApi","session",function(e,n,t,o){e.room="",e.name=o.getUser().username,e.badUsername=!1,e.init=function(){var a=document.location.pathname||"";return e.room=a,e.name?(t.addUser(e.name),setTimeout(function(){t.switchRoom(e.room)},1),e.username=e.name,n.username=e.name,o.setUser({username:e.name}),e.state.welcomeShwn=!0,void(n.room=a)):void(e.badUsername=!0)}}]),angular.module("app").directive("ngEnter",function(){return function(e,n,t){n.bind("keydown keypress",function(n){13===n.which&&(e.$apply(function(){e.$eval(t.ngEnter)}),n.preventDefault())})}}).directive("focus",function(){return{restrict:"A",link:function(e,n,t){e.$watch(t.focus,function(e){e&&n[0].focus()})}}}).filter("cut",function(){return function(e){return e?e.substr(0,8):""}});